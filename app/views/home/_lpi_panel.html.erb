<div id="lpi-panel" style="display: none;">
  <section class="usa-section grid-container">
    <p class="usa-heading">Enter each LPI mark from your datasheet. Tally will show at the end. </p>

    <div class="usa-prose scrollable-tally">
      <table class="usa-table">
        <thead>
          <tr>
            <th>Meter</th>
            <th>Cover</th>
            <th>Substrate</th>
          </tr>
        </thead>
        <tbody id="lpi-entries">
          <% 100.times do |i| %>
            <% meter=((i+1) * 0.15).round(2) %>
              <tr data-index="<%= i %>">
                <td>
                  <%= meter %>
                </td>
                <td>
                  <input type="text" class="usa-input cover-input" data-meter="<%= meter %>">
                </td>
                <td>
                  <select class="usa-select substrate-select" data-meter="<%= meter %>">
                    <option value="">-</option>
                    <option value="h">h</option>
                    <option value="s">s</option>
                    <option value="r">r</option>
                  </select>
                </td>
              </tr>
              <% end %>
        </tbody>
      </table>
    </div>
  </section>
</div>

<section>
  <div>
    <h3 class="usa-heading margin-top-4">Tally</h3>
    <table class="usa-table">
      <thead>
        <tr>
          <th>Cover</th>
          <th>h</th>
          <th>s</th>
          <th>r</th>
        </tr>
      </thead>
      <tbody id="tally-table">
        <!-- rows generated by JS -->
      </tbody>
    </table>
  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggleBtn = document.getElementById("toggle-lpi-entry");
  const lpiPanel = document.getElementById("lpi-panel");

  toggleBtn.addEventListener("click", () => {
    if (lpiPanel.style.display === "none") {
      lpiPanel.style.display = "block";
    } else {
      lpiPanel.style.display = "none";
    }
  });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const coverInputs = document.querySelectorAll(".cover-input");
  const substrateSelects = document.querySelectorAll(".substrate-select");
  const tallyTable = document.getElementById("tally-table");

  const updateTally = () => {
    const tally = {};

    coverInputs.forEach((input, idx) => {
      const cover = input.value.trim();
      const substrate = substrateSelects[idx].value;

      if (cover && substrate) {
        if (!tally[cover]) tally[cover] = { h: 0, s: 0, r: 0 };
        tally[cover][substrate]++;
      }
    });

    // clear tally table
    tallyTable.innerHTML = "";

    // rebuild tally table
    Object.keys(tally).sort().forEach(cover => {
      const counts = tally[cover];
      const row = `
        <tr>
          <td>${cover}</td>
          <td>${counts.h}</td>
          <td>${counts.s}</td>
          <td>${counts.r}</td>
        </tr>
      `;
      tallyTable.insertAdjacentHTML("beforeend", row);
    });
  };

  coverInputs.forEach(input => input.addEventListener("input", updateTally));
  substrateSelects.forEach(select => select.addEventListener("change", updateTally));
});
</script>





